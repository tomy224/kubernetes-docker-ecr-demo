# Docker + Kubernetes + AWS ECR å®Ÿè·µå­¦ç¿’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ

çŸ­æœŸé–“ã§ã‚³ãƒ³ãƒ†ãƒŠã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æŠ€è¡“ã‚’ç¿’å¾—ã—ã€AWSã‚¯ãƒ©ã‚¦ãƒ‰é€£æºã‚’å®Ÿè£…ã—ãŸãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã™ã€‚

## ğŸŒ Live Demo
**ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒ**: http://localhost:8080 (Docker)  
**Kubernetesç’°å¢ƒ**: minikube serviceçµŒç”±ã§ã‚¢ã‚¯ã‚»ã‚¹  
**AWS ECR**: ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ç®¡ç†

## ğŸ“‹ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

çŸ­æœŸé–“ã§ã®KubernetesåŸºç¤ç¿’å¾—ã‚’ç›®çš„ã¨ã—ã€Docker containerizationã€AWS ECRé€£æºã€Kubernetesãƒ‡ãƒ—ãƒ­ã‚¤ã®å®Œå…¨ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å®Ÿè£…ã—ã¾ã—ãŸã€‚

## ğŸ—ï¸ ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ

### ã‚³ãƒ³ãƒ†ãƒŠã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
![Docker to Kubernetes Learning Workflow](AWS_ECR_docker.drawio.svg)  

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ•ãƒ­ãƒ¼
```
[HTML App] â†’ [Docker Build] â†’ [AWS ECR Push] â†’ [Kubernetes Deploy] â†’ [Service Access]
     â†“              â†“               â†“                   â†“                    â†“
[é–‹ç™ºç’°å¢ƒ]       [ã‚³ãƒ³ãƒ†ãƒŠåŒ–]    [ã‚¯ãƒ©ã‚¦ãƒ‰ä¿å­˜]      [ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬]          [å¤–éƒ¨å…¬é–‹]
```

## ğŸ’» ä½¿ç”¨æŠ€è¡“ãƒ»ã‚µãƒ¼ãƒ“ã‚¹

### ã‚³ãƒ³ãƒ†ãƒŠæŠ€è¡“
| æŠ€è¡“ | å½¹å‰² | å­¦ç¿’å†…å®¹ |
|------|------|----------|
| **Docker** | ã‚³ãƒ³ãƒ†ãƒŠåŒ– | Dockerfileä½œæˆãƒ»ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰ãƒ»ãƒ­ãƒ¼ã‚«ãƒ«å®Ÿè¡Œ |
| **nginx** | Webã‚µãƒ¼ãƒãƒ¼ | è»½é‡HTTPã‚µãƒ¼ãƒãƒ¼ã§ã®é™çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„é…ä¿¡ |

### Kubernetes
| æŠ€è¡“ | å½¹å‰² | å®Ÿè£…å†…å®¹ |
|------|------|----------|
| **minikube** | ãƒ­ãƒ¼ã‚«ãƒ«K8sç’°å¢ƒ | å˜ä¸€ãƒãƒ¼ãƒ‰ã§ã®Kubernetesã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼æ§‹ç¯‰ |
| **Pod** | æœ€å°å®Ÿè¡Œå˜ä½ | ã‚³ãƒ³ãƒ†ãƒŠã®å®Ÿè¡Œãƒ»ç®¡ç†ãƒ»çŠ¶æ…‹ç›£è¦– |
| **Service** | ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç®¡ç† | å¤–éƒ¨ã‚¢ã‚¯ã‚»ã‚¹ãƒ»ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚° |
| **Deployment** | ã‚¢ãƒ—ãƒªç®¡ç† | ãƒ¬ãƒ—ãƒªã‚«æ•°åˆ¶å¾¡ãƒ»ãƒ­ãƒ¼ãƒªãƒ³ã‚°ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ |

### AWS ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£
| ã‚µãƒ¼ãƒ“ã‚¹ | å½¹å‰² | å®Ÿè£…å†…å®¹ |
|----------|------|----------|
| **Amazon ECR** | ã‚³ãƒ³ãƒ†ãƒŠãƒ¬ã‚¸ã‚¹ãƒˆãƒª | ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªã§ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ç®¡ç† |
| **IAM** | æ¨©é™ç®¡ç† | ECRã‚¢ã‚¯ã‚»ã‚¹ç”¨èªè¨¼ãƒ»æœ€å°æ¨©é™è¨­å®š |

## ğŸ”§ å®Ÿè£…æ‰‹é †ã¨å­¦ç¿’ãƒ—ãƒ­ã‚»ã‚¹

### Phase 1: DockeråŸºç¤ã¨ã‚³ãƒ³ãƒ†ãƒŠåŒ–
```bash
# ç°¡å˜ãªHTMLã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ä½œæˆ
echo "<h1>Hello from Docker!</h1><p>This app will run on Kubernetes</p>" > index.html

# Dockerfileä½œæˆãƒ»ãƒ“ãƒ«ãƒ‰
docker build -t my-first-k8s-app .
docker run -p 8080:80 my-first-k8s-app
```

### Phase 2: AWS ECRé€£æº
```bash
# ECRãƒªãƒã‚¸ãƒˆãƒªä½œæˆ
aws ecr create-repository --repository-name my-portfolio-k8s --region ap-northeast-1

# ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚¿ã‚°ä»˜ã‘ãƒ»ãƒ—ãƒƒã‚·ãƒ¥
docker tag my-first-k8s-app:latest 571600829497.dkr.ecr.ap-northeast-1.amazonaws.com/my-portfolio-k8s:latest
docker push 571600829497.dkr.ecr.ap-northeast-1.amazonaws.com/my-portfolio-k8s:latest
```

### Phase 3: Kubernetesãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ
```bash
# minikubeç’°å¢ƒæº–å‚™
minikube start
kubectl get nodes

# ãƒ­ãƒ¼ã‚«ãƒ«ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã®ãƒ‡ãƒ—ãƒ­ã‚¤
kubectl create deployment my-app --image=my-first-k8s-app
kubectl expose deployment my-app --type=NodePort --port=80

# ECRã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã®ãƒ‡ãƒ—ãƒ­ã‚¤
kubectl apply -f ecr-deployment.yaml
kubectl expose deployment ecr-app --type=NodePort --port=80
```

## ğŸ’¡ è§£æ±ºã—ãŸæŠ€è¡“èª²é¡Œ

### ImagePullBackOff ã‚¨ãƒ©ãƒ¼å¯¾å¿œ
**å•é¡Œ**: KubernetesãŒECRã‹ã‚‰ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å–å¾—ã§ããªã„  
**è§£æ±º**: imagePullPolicy: Neverè¨­å®šã§ãƒ­ãƒ¼ã‚«ãƒ«ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å¼·åˆ¶ä½¿ç”¨
```yaml
containers:
- image: 571600829497.dkr.ecr.ap-northeast-1.amazonaws.com/my-portfolio-k8s:latest
  imagePullPolicy: Never
```

### ECRèªè¨¼è¨­å®šã®ç°¡ç•¥åŒ–
**å•é¡Œ**: minikubeç’°å¢ƒã§ã®ECRèªè¨¼ãŒè¤‡é›‘  
**è§£æ±º**: ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ã®å­¦ç¿’ç›®çš„ã«åˆã‚ã›ãŸç¾å®Ÿçš„ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’æ¡ç”¨

## âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ»é‹ç”¨çµæœ

### å®Ÿè¡Œç’°å¢ƒã§ã®å‹•ä½œç¢ºèª
- **Dockerç’°å¢ƒ**: http://localhost:8080 ã§ã®æ­£å¸¸è¡¨ç¤º
- **Kubernetesç’°å¢ƒ**: minikube serviceçµŒç”±ã§ã®æ­£å¸¸ã‚¢ã‚¯ã‚»ã‚¹
- **PodçŠ¶æ…‹**: STATUS Running ã§å®‰å®šç¨¼åƒ
- **Serviceå…¬é–‹**: NodePortè¨­å®šã§å¤–éƒ¨ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½

### ãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨çŠ¶æ³
```bash
$ kubectl get pods
NAME                       READY   STATUS    RESTARTS   AGE
ecr-app-69c48548fd-xxx     1/1     Running   0          5m

$ kubectl get services  
NAME      TYPE       CLUSTER-IP    EXTERNAL-IP   PORT(S)        AGE
ecr-app   NodePort   10.96.12.50   <none>        80:30987/TCP   5m
```

## ğŸ’° ã‚³ã‚¹ãƒˆæœ€é©åŒ–

### AWS ECRé‹ç”¨è²»ç”¨
```
ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚µã‚¤ã‚º: 79.4MB
ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸è²»ç”¨: ç´„1.2å††/æœˆ
ãƒ‡ãƒ¼ã‚¿è»¢é€è²»ç”¨: ç´„1å†† (åˆå›ãƒ—ãƒƒã‚·ãƒ¥)
åˆè¨ˆ: ç´„3å††/æœˆ
```

## ğŸ“ˆ å­¦ç¿’æˆæœ

### åŸºæœ¬çš„ãªã‚³ãƒ³ãƒ†ãƒŠæŠ€è¡“ã®ç†è§£
- **DockeråŸºç¤**: HTMLã‚¢ãƒ—ãƒªã‚’nginxãƒ™ãƒ¼ã‚¹ã§ã‚³ãƒ³ãƒ†ãƒŠåŒ–
- **ã‚¤ãƒ¡ãƒ¼ã‚¸ç®¡ç†**: ãƒ­ãƒ¼ã‚«ãƒ«ãƒ“ãƒ«ãƒ‰ã‹ã‚‰ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ—ãƒƒã‚·ãƒ¥ã¾ã§ã®ä¸€é€£ã®æµã‚Œ
- **ãƒãƒ¼ãƒˆè¨­å®š**: ã‚³ãƒ³ãƒ†ãƒŠå†…å¤–ã§ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶š

### Kubernetesã®åŸºæœ¬æ“ä½œ
- **Podãƒ»Serviceãƒ»Deployment**: å„ãƒªã‚½ãƒ¼ã‚¹ã®åŸºæœ¬çš„ãªå½¹å‰²ã‚’ç†è§£
- **kubectlåŸºæœ¬ã‚³ãƒãƒ³ãƒ‰**: get, create, expose, applyã®å®Ÿè·µ
- **YAMLè¨­å®š**: åŸºæœ¬çš„ãªè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆã¨é©ç”¨

### AWS ã‚¯ãƒ©ã‚¦ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã®æ´»ç”¨
- **ECRãƒªãƒã‚¸ãƒˆãƒª**: ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªã§ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ç®¡ç†ä½“é¨“
- **AWS CLI**: åŸºæœ¬çš„ãªã‚³ãƒãƒ³ãƒ‰æ“ä½œ
- **ã‚³ã‚¹ãƒˆæ„è­˜**: å°è¦æ¨¡å­¦ç¿’ã§ã®è²»ç”¨ç®¡ç†ï¼ˆæœˆé¡3å††ç¨‹åº¦ï¼‰

### AIæ´»ç”¨ã«ã‚ˆã‚‹åŠ¹ç‡çš„å­¦ç¿’
- **æ¦‚å¿µç†è§£é‡è¦–**: ã‚³ãƒ¼ãƒ‰æš—è¨˜ã§ã¯ãªãã€ã€Œãªãœã“ã®æŠ€è¡“ãŒå¿…è¦ã‹ã€ã‚’AIå¯¾è©±ã§å­¦ç¿’
- **ã‚¨ãƒ©ãƒ¼è§£æ±º**: ç™ºç”Ÿã—ãŸå•é¡Œã‚’AIã‚µãƒãƒ¼ãƒˆã§ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è§£æ±º
- **çŸ­æœŸé–“ç¿’å¾—**: 2æ—¥é–“ã¨ã„ã†é™ã‚‰ã‚ŒãŸæ™‚é–“ã§ã®é›†ä¸­å­¦ç¿’ã‚’å®Ÿç¾

## ğŸ› ï¸ é–‹ç™ºãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †

### ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒ
```bash
# ãƒªãƒã‚¸ãƒˆãƒªã‚¯ãƒ­ãƒ¼ãƒ³
git clone https://github.com/tomy224/kubernetes-docker-ecr-demo.git
cd kubernetes-docker-ecr-demo

# Dockerç’°å¢ƒã§ã®ç¢ºèª
docker build -t my-first-k8s-app .
docker run -p 8080:80 my-first-k8s-app
```

### Kubernetesç’°å¢ƒæ§‹ç¯‰
```bash
# minikubeèµ·å‹•
minikube start

# ã‚¤ãƒ¡ãƒ¼ã‚¸èª­ã¿è¾¼ã¿ãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤
minikube image load my-first-k8s-app
kubectl apply -f deployment.yaml
kubectl expose deployment my-app --type=NodePort --port=80

# ã‚¢ã‚¯ã‚»ã‚¹ç¢ºèª
minikube service my-app --url
```

## ğŸ¯ å­¦ç¿’ä¾¡å€¤ã¨ä»Šå¾Œã®å±•é–‹

### çŸ­æœŸé–“ã§ã®æŠ€è¡“ç¿’å¾—åŠ¹æœ
- **2æ—¥é–“ã§ã®å®Œå…¨ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè£…**: Docker â†’ ECR â†’ Kubernetes
- **å®Ÿè·µçš„å•é¡Œè§£æ±ºèƒ½åŠ›**: ã‚¨ãƒ©ãƒ¼å¯¾å¿œãƒ»ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°çµŒé¨“
- **ã‚¯ãƒ©ã‚¦ãƒ‰ãƒã‚¤ãƒ†ã‚£ãƒ–åŸºç¤**: ã‚³ãƒ³ãƒ†ãƒŠã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ä¾¡å€¤ç†è§£

### ä»Šå¾Œã®å­¦ç¿’è¨ˆç”»
- **ãƒãƒ«ãƒãƒãƒ¼ãƒ‰ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼**: æœ¬æ ¼çš„ãªKubernetesç’°å¢ƒã§ã®é‹ç”¨
- **CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³**: GitHub Actionsã¨Kubernetesã®é€£æº
- **ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹å®Ÿè£…**: è¤‡æ•°ã‚³ãƒ³ãƒ†ãƒŠã§ã®ã‚µãƒ¼ãƒ“ã‚¹é–“é€šä¿¡
- **ç›£è¦–ãƒ»ãƒ­ã‚°ç®¡ç†**: Prometheusãƒ»Grafanaã§ã®é‹ç”¨ç›£è¦–

---

## ğŸ“§ Contact

**ä¼Šå¥ˆ æ–—å¤¢ (Inatom)**  
Cloud Infrastructure Engineer  
ğŸ”— GitHub: [tomy224](https://github.com/tomy224)  
ğŸ“ Location: æ„›çŸ¥çœŒ

---

*ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€çŸ­æœŸé–“ã§ã®Kubernetesç¿’å¾—ã‚’ç›®çš„ã¨ã—ãŸå®Ÿè·µå­¦ç¿’ã®æˆæœã§ã™ã€‚ã‚³ãƒ³ãƒ†ãƒŠã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æŠ€è¡“ã®åŸºç¤ã‹ã‚‰ã€AWSã‚¯ãƒ©ã‚¦ãƒ‰é€£æºã¾ã§ã€å®Ÿå‹™ã«è¿‘ã„ç’°å¢ƒã§ã®å­¦ç¿’ã‚’é‡è¦–ã—ã¦ã„ã¾ã™ã€‚*

## ğŸ“„ License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

å­¦ç¿’ç›®çš„ã§ã®åˆ©ç”¨ã‚„æ”¹è‰¯ã¯è‡ªç”±ã§ã™ã€‚ãŠå½¹ã«ç«‹ã¦ã°å¹¸ã„ã§ã™ï¼
